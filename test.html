<script language="JavaScript">
    //================================================================
    // Fetch Data

    function callRaFeedApi() {
        var certificateId = document.getElementById('tbCertId').value;
        var url = 'http://localhost:5001/api/Feed?CertificateId=' + encodeURIComponent(certificateId);

        var xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        
        // Setup the response handler
        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 300) {
                try {
                    var data = JSON.parse(xhr.responseText);
                    console.log("API Response:", data);
                    document.getElementById('locTbCommonName').value = data.data.name;
                    document.getElementById('locTbEmail').value = data.data.email;
                    document.getElementById('locTbUnstructuredAddress').value = data.data.mobile;
                    document.getElementById('locTbDeviceSerialNumber').value = data.data.tin;
                    document.getElementById('locTbTitle').value = data.data.designation;
                    document.getElementById('locTbOrg').value = data.data.company;
                    document.getElementById('locTbOrgUnit').value = data.data.department;
                    document.getElementById('locTbLocality').value = data.data.city;
                    document.getElementById('locTbState').value = data.data.state;
                    document.getElementById('locTbCountry').value = data.data.country;
                } catch (e) {
                    console.error("Failed to parse JSON response:", e);
                }
            } else if (xhr.status == 404) {
                try {
                    var errorData = JSON.parse(xhr.responseText);
                    if (errorData && errorData.data.message) {
                        alert(errorData.data.message);
                    }
                } catch (e) {
                    console.error("Error parsing 404 response:", e);
                }
            } else {
                console.error("Network response was not ok");
            }
        };

        xhr.onerror = function() {
            console.error("There was a problem with the request");
        };

        xhr.send();
    }
</script>
